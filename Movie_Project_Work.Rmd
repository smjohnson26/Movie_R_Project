---
title: "Movie Project Work"
author: "Steven Johnson"
date: "11/12/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

library(readr)
library(leaps)
library("stringr")
library(ggplot2)
library(car)

IMDb_movies <- read.csv("C:/Users/balli/Documents/Movie_R_Project/imdb movies.csv")
ratings <- read.csv("C:/Users/balli/Documents/Movie_R_Project/IMDb ratings.csv")
cpi_rates <- read_csv("C:/Users/balli/Documents/Movie_R_Project/cpi_table.csv")
names(ratings)<-str_replace_all(names(ratings), c("_" = "." , "," = "" ))
names(IMDb_movies)<-str_replace_all(names(IMDb_movies), c("_" = "." , "," = "" ))
#rename 'worlwide' to 'worldwide'
colnames(IMDb_movies)[19] <- "worldwide.gross.income"

IMDb_movies["IsItHorror"]<- 0
IMDb_movies["IsItRomance"] <- 0
IMDb_movies["IsItAction"] <- 0
IMDb_movies["IsItComedy"] <- 0
IMDb_movies["IsItDrama"] <- 0
IMDb_movies$IsItHorror[grep("Horror",IMDb_movies$genre)] <- 1
IMDb_movies$IsItRomance[grep("Romance",IMDb_movies$genre)] <- 1
IMDb_movies$IsItAction[grep("Action",IMDb_movies$genre)] <- 1
IMDb_movies$IsItComedy[grep("Comedy",IMDb_movies$genre)] <- 1
IMDb_movies$IsItDrama[grep("Drama",IMDb_movies$genre)] <- 1
IMDb_movies$IsItHorror<-as.factor(IMDb_movies$IsItHorror)
IMDb_movies$IsItRomance<-as.factor(IMDb_movies$IsItRomance)
IMDb_movies$IsItAction<-as.factor(IMDb_movies$IsItAction)
IMDb_movies$IsItComedy<-as.factor(IMDb_movies$IsItComedy)
IMDb_movies$IsItDrama<-as.factor(IMDb_movies$IsItDrama)


IMDb_movies$budget[IMDb_movies$budget == ''] <- 'Unknown'
budget <- IMDb_movies[(IMDb_movies$budget!= "Unknown"), ]
budget$usa.gross.income[budget$usa.gross.income == ""] <- 'Unknown'
usamovies <- budget[(budget$usa.gross.income!= "Unknown"), ]

usamovies$country[usamovies$country == ""] <- 'Unknown'
usamovies1 <- usamovies[(usamovies$country != "Unknown"), ]
usamovies2<-usamovies1[grep("USA",usamovies1$country),]
usamovies2$Currency <- substr(usamovies2$budget, start = 1, stop = 3)
for(value in 1:6605){
  if(substr(usamovies2$Currency[value], start = 1, stop = 1)=="$"){
    usamovies2$Currency[value] = "USD"
  }
}

USAMOVIES<-subset(usamovies2, usamovies2$Currency== "USD")
USAMOVIES$budget <- substr(USAMOVIES$budget, start = 2, stop = 15)
USAMOVIES$usa.gross.income <- substr(USAMOVIES$usa.gross.income, start = 2, stop = 15)
USAMOVIES$worldwide.gross.income <- substr(USAMOVIES$worldwide.gross.income, start = 2, stop = 15)
USAMOVIES$budget <- as.numeric(USAMOVIES$budget)
USAMOVIES$usa.gross.income <- as.numeric(USAMOVIES$usa.gross.income)
USAMOVIES$worldwide.gross.income <- as.numeric(USAMOVIES$worldwide.gross.income)
USAMOVIES$profit <-(USAMOVIES$worldwide.gross.income- USAMOVIES$budget)
summary(USAMOVIES)





#make year column into the index for cpi_rates dataframe
row.names(cpi_rates) <- cpi_rates$Year
cpi_rates[1] <- NULL
cpi_2020 <-  cpi_rates["2020", 1]


#Formula for inflated values: (original value * 2020 Consumer Price Index Value) / Consumer Price Index From Year of Release
for(val in 1:nrow(USAMOVIES)){
  USAMOVIES[val, "budg_infl"] <- (USAMOVIES[val, "budget"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
  USAMOVIES[val, "worldwide_gross_infl"] <- (USAMOVIES[val, "worldwide.gross.income"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
  USAMOVIES[val, "usa_gross_infl"] <- (USAMOVIES[val, "usa.gross.income"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
  USAMOVIES[val, "profit_infl"] <- (USAMOVIES[val, "profit"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
}

USAMOVIES1 <- USAMOVIES


USAMOVIES1 <- merge(USAMOVIES1,ratings,by="imdb.title.id")









How are ratings affected by movie genre, movie duration, gender, or age group?
```{r}

setwd("C:\\Users\\balli\\Documents\\Movie_R_Project")
library(readr)
library(leaps)
library("stringr")
library(ggplot2)
library(car)

IMDb_movies <- read.csv("C:/Users/balli/Documents/Movie_R_Project/imdb movies.csv")
ratings <- read.csv("C:/Users/balli/Documents/Movie_R_Project/IMDb ratings.csv")
cpi_rates <- read_csv("C:/Users/balli/Documents/Movie_R_Project/cpi_table.csv")
names(ratings)<-str_replace_all(names(ratings), c("_" = "." , "," = "" ))
names(IMDb_movies)<-str_replace_all(names(IMDb_movies), c("_" = "." , "," = "" ))
#rename 'worlwide' to 'worldwide'
colnames(IMDb_movies)[19] <- "worldwide.gross.income"

IMDb_movies["IsItHorror"]<- 0
IMDb_movies["IsItRomance"] <- 0
IMDb_movies["IsItAction"] <- 0
IMDb_movies["IsItComedy"] <- 0
IMDb_movies["IsItDrama"] <- 0
IMDb_movies$IsItHorror[grep("Horror",IMDb_movies$genre)] <- 1
IMDb_movies$IsItRomance[grep("Romance",IMDb_movies$genre)] <- 1
IMDb_movies$IsItAction[grep("Action",IMDb_movies$genre)] <- 1
IMDb_movies$IsItComedy[grep("Comedy",IMDb_movies$genre)] <- 1
IMDb_movies$IsItDrama[grep("Drama",IMDb_movies$genre)] <- 1
IMDb_movies$IsItHorror<-as.factor(IMDb_movies$IsItHorror)
IMDb_movies$IsItRomance<-as.factor(IMDb_movies$IsItRomance)
IMDb_movies$IsItAction<-as.factor(IMDb_movies$IsItAction)
IMDb_movies$IsItComedy<-as.factor(IMDb_movies$IsItComedy)
IMDb_movies$IsItDrama<-as.factor(IMDb_movies$IsItDrama)


IMDb_movies$budget[IMDb_movies$budget == ''] <- 'Unknown'
budget <- IMDb_movies[(IMDb_movies$budget!= "Unknown"), ]
budget$usa.gross.income[budget$usa.gross.income == ""] <- 'Unknown'
usamovies <- budget[(budget$usa.gross.income!= "Unknown"), ]

usamovies$country[usamovies$country == ""] <- 'Unknown'
usamovies1 <- usamovies[(usamovies$country != "Unknown"), ]
usamovies2<-usamovies1[grep("USA",usamovies1$country),]
usamovies2$Currency <- substr(usamovies2$budget, start = 1, stop = 3)
for(value in 1:6605){
  if(substr(usamovies2$Currency[value], start = 1, stop = 1)=="$"){
    usamovies2$Currency[value] = "USD"
  }
}

USAMOVIES<-subset(usamovies2, usamovies2$Currency== "USD")
USAMOVIES$budget <- substr(USAMOVIES$budget, start = 2, stop = 15)
USAMOVIES$usa.gross.income <- substr(USAMOVIES$usa.gross.income, start = 2, stop = 15)
USAMOVIES$worldwide.gross.income <- substr(USAMOVIES$worldwide.gross.income, start = 2, stop = 15)
USAMOVIES$budget <- as.numeric(USAMOVIES$budget)
USAMOVIES$usa.gross.income <- as.numeric(USAMOVIES$usa.gross.income)
USAMOVIES$worldwide.gross.income <- as.numeric(USAMOVIES$worldwide.gross.income)
USAMOVIES$profit <-(USAMOVIES$worldwide.gross.income- USAMOVIES$budget)
summary(USAMOVIES)





#make year column into the index for cpi_rates dataframe
row.names(cpi_rates) <- cpi_rates$Year
cpi_rates[1] <- NULL
cpi_2020 <-  cpi_rates["2020", 1]


#Formula for inflated values: (original value * 2020 Consumer Price Index Value) / Consumer Price Index From Year of Release
for(val in 1:nrow(USAMOVIES)){
  USAMOVIES[val, "budg_infl"] <- (USAMOVIES[val, "budget"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
  USAMOVIES[val, "worldwide_gross_infl"] <- (USAMOVIES[val, "worldwide.gross.income"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
  USAMOVIES[val, "usa_gross_infl"] <- (USAMOVIES[val, "usa.gross.income"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
  USAMOVIES[val, "profit_infl"] <- (USAMOVIES[val, "profit"] * cpi_2020) / cpi_rates[toString(USAMOVIES[val, "year"]), "Avg"]
}

USAMOVIES1 <- USAMOVIES


USAMOVIES1 <- merge(USAMOVIES1,ratings,by="imdb.title.id")
```

##Setting up Columns for Genres
While movies can have a multitude of genres and even multiple genres to describe 
their specific style, I thought it would be worthwhile to look at the top five
genres listed for types of movies. These genres were drama, comedy, action, romance,
and horror. Movies can be both a comedy and a romance movie or any combination of the
genres. To deal with this, I decided to make five binary columns that described whether
the genre or genres of the movie contained that specific type. 






## Are ratings affected by genre?

```{r}
attach(USAMOVIES1)
lm_all <- lm(avg.vote ~ IsItHorror + IsItRomance + IsItAction + IsItComedy + IsItDrama)
summary(lm_all)
```
Above, I ran a multiple linear regression that tried to predict the average vote based
on the top five genres I discussed in the previous section. Based on the summary,
the model is significant and all variables are also significant. This tells us that 
the genre of a movie will affect the voting on the quality of the movie. Below, I 
examine using t.tests whether there is a significance between the difference of means
of movies of a specific genre type and movies that do not contain that genre.
        

## Horror Plots
### T-Tests
```{r}
Horror <- subset(USAMOVIES1, IsItHorror == 1, select = c(avg.vote))
NoHorror <- subset(USAMOVIES1, IsItHorror == 0, select = c(avg.vote))
t.test(Horror,NoHorror)
```
Based on the t-test above, we can see there is a difference between -0.7031330 and 
-0.5389663 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that horror movies will have 
a lower rating in general compared to other movie types. The histograms below show this spread.
```{r}
p <- ggplot(Horror, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Horror Movie Ratings")
p <- ggplot(NoHorror, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Horror Movie Ratings")
```
## Romance Plots 
```{r}
Romance <- subset(USAMOVIES1, IsItRomance == 1, select = c(avg.vote))
NoRomance <- subset(USAMOVIES1, IsItRomance == 0, select = c(avg.vote))
t.test(Romance, NoRomance)
```
Based on the t-test above, we can see there is a difference between -0.07828863 and 
0.03853488 with a 95% confidence interval. Because of this interval, there is not a significant 
difference in the means of these groups of movies due to the fact that our confidence 
interval includes 0. This means that the ratings of a Romance movie and a non-romantic
movie will not have a significant difference in mean based on the genre.The histograms
below show the spread of the data.

```{r}
p <- ggplot(Romance, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Romance Movie Ratings")
            
p <- ggplot(NoRomance, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Romance Movie Ratings")
```

## Action Plots
```{r}
Action <- subset(USAMOVIES1, IsItAction == 1, select = c(avg.vote))
NoAction <- subset(USAMOVIES1, IsItAction == 0, select = c(avg.vote))
t.test(Action,NoAction)
```
Based on the t-test above, we can see there is a difference between -0.17345224 and 
-0.05673903 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that action movies will have 
a slightly lower rating in general compared to other movie types. The histograms below show this spread.

```{r}
p <- ggplot(Action, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Action Movie Ratings")
            
p <- ggplot(NoAction, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Action Movie Ratings")
```

## Comedy Plot
```{r}
Comedy <- subset(USAMOVIES1, IsItComedy == 1, select = c(avg.vote))
NoComedy <- subset(USAMOVIES1, IsItComedy == 0, select = c(avg.vote))
t.test(Comedy,NoComedy)
```
Based on the t-test above, we can see there is a difference between -0.3428530 and 
-0.2429231 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that comedy movies will have 
a lower rating in general compared to other movie types. The histograms below show this spread.

```{r}
p <- ggplot(Comedy, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Comedy Movie Ratings")
            
p <- ggplot(NoComedy, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Comedy Movie Ratings")
```
            
## Drama Plot
```{r}
Drama <- subset(USAMOVIES1, IsItDrama == 1, select = c(avg.vote))
NoDrama <- subset(USAMOVIES1, IsItDrama == 0, select = c(avg.vote))
t.test(Drama,NoDrama)
```
Based on the t-test above, we can see there is a difference between 0.4930031 and 
0.5904080 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that dramatic movies will have 
a higher rating in general compared to other movie types. The histograms below show this spread.

```{r}
p <- ggplot(Drama, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Drama Movie Ratings")
            
p <- ggplot(NoDrama, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Drama Movie Ratings")
```
            
            
## How are Ratings Affected by Gender?
We shift gears in this section from genres into whether gender plays a role in the 
average rating of a movie. The t-test below checks to see if their is a significant 
difference in the means of the female's average vote and the male's average vote. 
We can see from the test that females vote more positivitely for movies on average
in a range from 0.1812546 to 0.2513334 on a 95% percent confidence interval. 
```{r}
t.test(females.allages.avg.vote,males.allages.avg.vote)
```
The histogram below shows the spread of the two genders' votes. The male vote is indicated 
with blue bars. The female vote is represented using pink bars. The overlap in the votes
is indicated using the purple bars. We can see from the histogram the confirmation of the 
observation above that females votes more positively for movies on average than males.
```{r}
hgf <- hist(females.allages.avg.vote,plot = FALSE)
hgm <- hist(males.allages.avg.vote,plot = FALSE)

plot(hgf,col = rgb(1,0,0,.2), main = "Spread of Female and Male Vote")
plot(hgm,col = rgb(0,0,1,.2), add=TRUE)
```
In the next two sections, I wanted to combine the ideas from the two sections above.
Is there a significant difference in average voting for a movie based on genres and gender.
I chose to look specifically at two stereotypical movie and gender combinations to see
if the stereotype would hold true when looking at the data. These combinations were
women and romance movies and men and action movies. Below, I will examine if there is 
a significant difference in the data when looking at males and females votes specifically in the romance
and action movie genres.
## Do Females Actually Like Romantic Movies More than Males?
```{r}
Romance1 <- subset(USAMOVIES1, IsItRomance == 1, select = c(avg.vote,males.allages.avg.vote,females.allages.avg.vote))
t.test(Romance1$females.allages.avg.vote,Romance1$males.allages.avg.vote)
```
We can see from the t-test above that women will vote between 0.1912656 and 0.3371316
points higher than males on movies in the romance category in a 95% confidence interval.
Below you can see that spread in a box plot:
```{r}
boxplot(Romance1$females.allages.avg.vote,Romance1$males.allages.avg.vote,
names = c("Female","Male"),
col = c("pink","blue"))
```

## Do Males Actually Like Action Movies More than Females?
```{r}
Action1 <- subset(USAMOVIES1, IsItAction == 1, select = c(avg.vote,males.allages.avg.vote,females.allages.avg.vote))
t.test(Action1$females.allages.avg.vote,Action1$males.allages.avg.vote)
```
We can see from the t-test above that women will vote between 0.1003357 and 0.2405763
points higher than males on movies in the female category in a 95% confidence interval.
This contradicts the stereotype that males like action movies more than females.
Below you can see that spread in a box plot:
```{r}
boxplot(Action1$females.allages.avg.vote,Action1$males.allages.avg.vote,
names = c("Female","Male"),
col = c("pink","blue"))
```

## How Does Movie Duration Affect a Movie's Success?
In the section below, we will look to see if there is any correlation between the duration
of movies and the average votes for the movie.
### Initial Model
```{r}
duration_lm <- lm(avg.vote~ duration)
summary(duration_lm)
plot(duration,avg.vote)
abline(duration_lm, col = 'red')
```
### Model after taking out some outlier values
```{r}
res_std <- rstandard(duration_lm)
USAMOVIES1$res_std = res_std
USAMOVIES2 <- USAMOVIES1[USAMOVIES1$res_std <= 2,]
USAMOVIES3 <- USAMOVIES2[USAMOVIES1$res_std >= -2,]
duration_lm2 <- lm(USAMOVIES3$avg.vote~ USAMOVIES3$duration)
summary(duration_lm2)
plot(USAMOVIES3$duration,USAMOVIES3$avg.vote)
abline(duration_lm2, col= 'red')
```
We can see from the summary above that the model and the variable for duration is 
significant when predicting the average vote.



