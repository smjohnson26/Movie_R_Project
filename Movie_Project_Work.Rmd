---
title: "Movie Project Work"
author: "Steven Johnson"
date: "11/12/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
How are ratings affected by movie genre, movie duration, gender, or age group?


##Reading in Data and Libraries and removing un-needed columns
```{r}
library(readr)
library("stringr")
library(dplyr)
library(ggplot2)
library(car)
USAMOVIES <- read.csv("C:/Users/balli/Documents/Movie_R_Project/USAMOVIES_INFL.csv")
summary(USAMOVIES)
ratings <- read.csv("C:/Users/balli/Documents/Movie_R_Project/IMDb ratings.csv")
names(ratings)<-str_replace_all(names(ratings), c("_" = "." , "," = "" ))
names(USAMOVIES)<-str_replace_all(names(USAMOVIES), c("_" = "." , "," = "" ))
USAMOVIES$profit <-(USAMOVIES$worldwide.gross.infl- USAMOVIES$budget.infl)
USAMOVIES<-USAMOVIES[!is.na(USAMOVIES$reviews.from.users)&!is.na(USAMOVIES$reviews.from.critics),]
USAMOVIES <- select(USAMOVIES,-c("metascore"))
USAMOVIES1 <- USAMOVIES

USAMOVIES1 <- select(USAMOVIES,-c("title","date.published","director","writer",
"production.company","actors","description","Currency","reviews.from.users",
"reviews.from.critics","votes","usa.gross.income","worlwide.gross.income"))
ratings <- select(ratings,c("imdb.title.id","weighted.average.vote","allgenders.0age.avg.vote",
"allgenders.18age.avg.vote","allgenders.30age.avg.vote","allgenders.45age.avg.vote",
"females.allages.avg.vote","males.allages.avg.vote"))
USAMOVIES1 <- merge(USAMOVIES1,ratings,by="imdb.title.id")
```


##Setting up Columns for Genres
While movies can have a multitude of genres and even multiple genres to describe 
their specific style, I thought it would be worthwhile to look at the top five
genres listed for types of movies. These genres were drama, comedy, action, romance,
and horror. Movies can be both a comedy and a romance movie or any combination of the
genres. To deal with this, I decided to make five binary columns that described whether
the genre or genres of the movie contained that specific type. 
```{r}
USAMOVIES1["IsItHorror"]<- 0
USAMOVIES1["IsItRomance"] <- 0
USAMOVIES1["IsItAction"] <- 0
USAMOVIES1["IsItComedy"] <- 0
USAMOVIES1["IsItDrama"] <- 0
USAMOVIES1$IsItHorror[grep("Horror",USAMOVIES1$genre)] <- 1
USAMOVIES1$IsItRomance[grep("Romance",USAMOVIES1$genre)] <- 1
USAMOVIES1$IsItAction[grep("Action",USAMOVIES1$genre)] <- 1
USAMOVIES1$IsItComedy[grep("Comedy",USAMOVIES1$genre)] <- 1
USAMOVIES1$IsItDrama[grep("Drama",USAMOVIES1$genre)] <- 1
```

## Are ratings affected by genre?

```{r}
attach(USAMOVIES1)
lm_all <- lm(avg.vote ~ IsItHorror + IsItRomance + IsItAction + IsItComedy + IsItDrama)
summary(lm_all)
```
Above, I ran a multiple linear regression that tried to predict the average vote based
on the top five genres I discussed in the previous section. Based on the summary,
the model is significant and all variables are also significant. This tells us that 
the genre of a movie will affect the voting on the quality of the movie. Below, I 
examine using t.tests whether there is a significance between the difference of means
of movies of a specific genre type and movies that do not contain that genre.
        

## Horror Plots
### T-Tests
```{r}
Horror <- subset(USAMOVIES1, IsItHorror == 1, select = c(avg.vote))
NoHorror <- subset(USAMOVIES1, IsItHorror == 0, select = c(avg.vote))
t.test(Horror,NoHorror)
```
Based on the t-test above, we can see there is a difference between -.7249547 and 
-.5494581 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that horror movies will have 
a lower rating in general compared to other movie types. The histograms below show this spread.
```{r}
p <- ggplot(Horror, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Horror Movie Ratings")
p <- ggplot(NoHorror, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Horror Movie Ratings")
```
## Romance Plots 
```{r}
Romance <- subset(USAMOVIES1, IsItRomance == 1, select = c(avg.vote))
NoRomance <- subset(USAMOVIES1, IsItRomance == 0, select = c(avg.vote))
t.test(Romance, NoRomance)
```
Based on the t-test above, we can see there is a difference between -0.10564471 and 
0.01899697 with a 95% confidence interval. Because of this interval, there is not a significant 
difference in the means of these groups of movies due to the fact that our confidence 
interval includes 0. This means that the ratings of a Romance movie and a non-romantic
movie will not have a significant difference in mean based on the genre.The histograms
below show the spread of the data.

```{r}
p <- ggplot(Romance, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Romance Movie Ratings")
            
p <- ggplot(NoRomance, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Romance Movie Ratings")
```

## Action Plots
```{r}
Action <- subset(USAMOVIES1, IsItAction == 1, select = c(avg.vote))
NoAction <- subset(USAMOVIES1, IsItAction == 0, select = c(avg.vote))
t.test(Action,NoAction)
```
Based on the t-test above, we can see there is a difference between -0.14717992 and 
-0.02210198 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that action movies will have 
a slightly lower rating in general compared to other movie types. The histograms below show this spread.

```{r}
p <- ggplot(Action, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Action Movie Ratings")
            
p <- ggplot(NoAction, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Action Movie Ratings")
```

## Comedy Plot
```{r}
Comedy <- subset(USAMOVIES1, IsItComedy == 1, select = c(avg.vote))
NoComedy <- subset(USAMOVIES1, IsItComedy == 0, select = c(avg.vote))
t.test(Comedy,NoComedy)
```
Based on the t-test above, we can see there is a difference between -0.3327587 and 
-0.2255355 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that comedy movies will have 
a lower rating in general compared to other movie types. The histograms below show this spread.

```{r}
p <- ggplot(Comedy, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Comedy Movie Ratings")
            
p <- ggplot(NoComedy, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Comedy Movie Ratings")
```
            
## Drama Plot
```{r}
Drama <- subset(USAMOVIES1, IsItDrama == 1, select = c(avg.vote))
NoDrama <- subset(USAMOVIES1, IsItDrama == 0, select = c(avg.vote))
t.test(Drama,NoDrama)
```
Based on the t-test above, we can see there is a difference between 0.4676931 and 
0.5725751 with a 95% confidence interval. Because of this interval, there is a significant 
difference in the means of these groups of movies. This shows that dramatic movies will have 
a higher rating in general compared to other movie types. The histograms below show this spread.

```{r}
p <- ggplot(Drama, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Drama Movie Ratings")
            
p <- ggplot(NoDrama, aes(x=avg.vote)) + 
 geom_histogram(aes(y=..density..), colour="black", fill="white")+
 geom_density(alpha=.2, fill="#FF6666") + scale_x_continuous(breaks=seq(0, 10, 0.5))
 p+ geom_vline(aes(xintercept=mean(avg.vote)),
            color="blue", linetype="dashed", size=1) + ggtitle("Spread of Non-Drama Movie Ratings")
```
            
            
## How are Ratings Affected by Gender?
We shift gears in this section from genres into whether gender plays a role in the 
average rating of a movie. The t-test below checks to see if their is a significant 
difference in the means of the female's average vote and the male's average vote. 
We can see from the test that females vote more positivitely for movies on average
in a range from 0.1765551 to 0.2521195 on a 95% percent confidence interval. 
```{r}
t.test(females.allages.avg.vote,males.allages.avg.vote)
```
The histogram below shows the spread of the two genders' votes. The male vote is indicated 
with blue bars. The female vote is represented using pink bars. The overlap in the votes
is indicated using the purple bars. We can see from the histogram the confirmation of the 
observation above that females votes more positively for movies on average than males.
```{r}
hgf <- hist(females.allages.avg.vote,plot = FALSE)
hgm <- hist(males.allages.avg.vote,plot = FALSE)

plot(hgf,col = rgb(1,0,0,.2), main = "Spread of Female and Male Vote")
plot(hgm,col = rgb(0,0,1,.2), add=TRUE)
```
In the next two sections, I wanted to combine the ideas from the two sections above.
Is there a significant difference in average voting for a movie based on genres and gender.
I chose to look specifically at two stereotypical movie and gender combinations to see
if the stereotype would hold true when looking at the data. These combinations were
women and romance movies and men and action movies. Below, I will examine if there is 
a significant difference in the data when looking at males and females votes specifically in the romance
and action movie genres.
## Do Females Actually Like Romantic Movies More than Males?
```{r}
Romance1 <- subset(USAMOVIES1, IsItRomance == 1, select = c(avg.vote,males.allages.avg.vote,females.allages.avg.vote))
t.test(Romance1$females.allages.avg.vote,Romance1$males.allages.avg.vote)
```
We can see from the t-test above that women will vote between 0.1824913 and 0.3375087
points higher than males on movies in the female category in a 95% confidence interval.
Below you can see that spread in a box plot:
```{r}
boxplot(Romance1$females.allages.avg.vote,Romance1$males.allages.avg.vote,
names = c("Female","Male"),
col = c("pink","blue"))
```

## Do Males Actually Like Action Movies More than Females?
```{r}
Action1 <- subset(USAMOVIES1, IsItAction == 1, select = c(avg.vote,males.allages.avg.vote,females.allages.avg.vote))
t.test(Action1$females.allages.avg.vote,Action1$males.allages.avg.vote)
```
We can see from the t-test above that women will vote between 0.08886368 and 0.23874368
points higher than males on movies in the female category in a 95% confidence interval.
This contradicts the stereotype that males like action movies more than females.
Below you can see that spread in a box plot:
```{r}
boxplot(Action1$females.allages.avg.vote,Action1$males.allages.avg.vote,
names = c("Female","Male"),
col = c("pink","blue"))
```

## How Does Movie Duration Affect a Movie's Success?
In the section below, we will look to see if there is any correlation between the duration
of movies and the average votes for the movie.
### Initial Model
```{r}
duration_lm <- lm(avg.vote~ duration)
summary(duration_lm)
plot(duration,avg.vote)
abline(duration_lm, col = 'red')
```
### Model after taking out some outlier values
```{r}
res_std <- rstandard(duration_lm)
USAMOVIES1$res_std = res_std
USAMOVIES2 <- USAMOVIES1[USAMOVIES1$res_std <= 2,]
USAMOVIES3 <- USAMOVIES2[USAMOVIES1$res_std >= -2,]
duration_lm2 <- lm(USAMOVIES3$avg.vote~ USAMOVIES3$duration)
summary(duration_lm2)
plot(USAMOVIES3$duration,USAMOVIES3$avg.vote)
abline(duration_lm2, col= 'red')
```
We can see from the summary above that the model and the variable for duration is 
significant when predicting the average vote.



